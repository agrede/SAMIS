function res = measAccuracy(f,Z,HP,IT,Vac,Vdc,Cl,T)
%
% Copyright (C) 2013--2016 Alex J. Grede
% GPL v3, See LICENSE.txt for details
% This function is part of SAMIS (https://github.com/agrede/SAMIS)

res = struct;
f = f(ones(1,size(Z,1)),:);
TD = abs(T-296.15);
ZM = abs(Z);
res.Acal =  (ZM<10).*(1==HP).*0.1            ...
       +(ZM<300).*(((HP==0)+(10<=ZM))>0)     ...
            .*(0.03                          ...
             + 0.02.*(1e3<=f)                ...
             + 5e-8.*f.*(100e3<=f))          ...
       +((300<=ZM).*(ZM<3e3)).*(0.03+0.2.*(10e3<=f)) ...
       +(3e3<=ZM).*(0.03+1e-7.*f)            ...
       +(30e3<=ZM).*(9e-7.*f.*(f<300e3));
res.thetacal =  (ZM<10).*(100e3<=f).*(1==HP).*((300+f).*1e-6-1e-4) ...
           +1e-4                                               ...
           +(ZM<300).*(((HP==0)+(10<=ZM))>0).*(                ...
               +1e-4.*(1e3<=f)                                 ...
               +1e-4.*(10e3<=f)                                ...
               +2e-10.*f.*(ZM<10))                             ...
           +(300<=ZM).*(ZM<3e3).*2e-4                          ...
           +(3e3<=ZM).*2.5e-9.*f                               ...
           +(30e3<=ZM).*(f<30e3).*18.5e-9.*f;

Atl = (IT<1).*((Vac<0.05).*(exp(((log(2)-log(0.2))./(log(5e-3)-log(50e-3))).*(log(Vac)-log(50e-3)))+0.2)...
              +(0.05<=Vac).*(Vac<0.15).*0.02...
              +(0.15<=Vac).*(Vac<0.3).*(exp((log(0.2)-log(0.1))./(log(0.15)-log(0.3)).*(log(Vac)-log(0.3)))+0.1)...
              +(0.3<=Vac).*(Vac<1).*0.1...
              +(1<=Vac).*(Vac<2).*(exp((log(0.1)-log(0.15))./(log(1)-log(2)).*(log(Vac)-log(1)))+0.1)...
              +(2<=Vac).*0.15)...
      +(0<IT).*((Vac<0.03).*(exp(((log(0.6)-log(0.1))./(log(5e-3)-log(30e-3))).*(log(Vac)-log(30e-3)))+0.1)...
              +(0.03<=Vac).*(Vac<0.15).*0.01...
              +(0.15<=Vac).*(Vac<0.3).*(exp((log(0.1)-log(0.05))./(log(0.15)-log(0.3)).*(log(Vac)-log(0.3)))+0.05)...
              +(0.3<=Vac).*(Vac<1).*0.05...
              +(1<=Vac).*(Vac<2).*(exp((log(0.05)-log(0.1))./(log(1)-log(2)).*(log(Vac)-log(1)))+0.05)...
              +(2<=Vac).*(Vac<10).*0.1...
              +(10<=Vac).*(exp((log(0.15)-log(0.1))./(log(10)-log(20)).*(log(Vac)-log(10)))+0.1));
SA2RNG = (ZM<320e3).*(((100e3<ZM).*(100e3<f)+(300e3<f).*(32e3<ZM))>0);
A4RNG = (30e3<f).*(abs(1./(I.*2.*pi.*f.*100e-12))<ZM).*(ZM<=320e3).*(~SA2RNG);
A1RNG = (100e3<f).*(15<ZM).*(ZM<=320e3).*((SA2RNG+A4RNG)<1);
A3RNG = (f<=1e3).*(((ZM<=100e-3)+(10e6<ZM)+(f<=50))>0);
A2RNG = ((A1RNG+A3RNG+A4RNG)<1);

A0 = (1 + 0.5.*(0<IT).*(f<100)+(0<IT).*(f<=300)).*(                ...
       Atl                                                         ...
      +A1RNG.*(0.3<=Vac).*(Vac<=1).*(0.05+0.05.*(IT<1)-Atl)        ...
      +A2RNG.*(0.1+0.1.*(IT<1)-Atl).*(0.15<Vac).*(Vac<=2)            ...
      +A3RNG.*(0.25+0.05.*(IT<1)-Atl).*((12e-3+21e-3.*(IT<1))<Vac) ...
      +A4RNG.*(0.1+0.5.*Atl.*(IT<1)-Atl).*(0.15<Vac).*(Vac<=2)     ...
     ); % Have not included inductor for high test voltage

Ka = (1+1.5.*(IT<1)).*1e-3./ZM.*((1+(IT<1)).*200e-3./Vac...
            +(100e3<f)+(3e3<f).*(1+1e-14.*Vac.^2)).*(1+(f<100).*sqrt(100./f));
Kb = ZM.*1e-9.*(1+(IT<1)).*(1+2.*(100e3<f)+7.*(300e3<f)).*(1+(0.07+0.03.*(IT<1))./Vac)...
      .*(1+(f<100).*sqrt(100./f));
Kaa =  (Vac<=2).*((2<=Cl).*Cl./4.*Ka)...
      +(2<Vac).*(1e-3.*(1e-6.*f).^2.*(2.5.*Cl-0.5.*(Cl<2))+(2<Cl).*1e-3.*Cl./2)./ZM;
Kbb = 1+1e-6.*f.*Cl.*(0.5+1.5.*(f<=300e3)+3.*(f<=100));
Cf = permute([1;1.2;1.5;2;2.5;3;4;5;6;8],[3,2,1]);
Kc = 0.0003.*sum(Cf(ones(1,size(f,1)),ones(1,size(f,2)),:)...
                 ~=(f(:,:,ones(1,size(Cf,3)))./10.^floor(log(f(:,:,ones(1,10)))./log(10))),3);
Kd = 2.5.*Cl.*10.^(-7+(2<Vac)).*(1+(16+34.*(Vac<=2)).*f);
Ke = 1+(5<=TD)+2.*(15<=TD);


res.Ae = (A0+100.*(Ka+Kaa+Kb.*Kbb+Kc)+Kd).*Ke;
res.thetae = res.Ae./100;
res.A = res.Ae+res.Acal;
res.theta = res.thetae+res.thetacal;

endfunction
